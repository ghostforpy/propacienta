DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS pacients;
DROP TABLE IF EXISTS doctors;
DROP TABLE IF EXISTS medicine_card;
DROP TABLE IF EXISTS appointment_order;
DROP TABLE IF EXISTS doctors_appointment;
DROP TABLE IF EXISTS doctors_prescriptions;
DROP TABLE IF EXISTS doctors_specialization;
DROP TABLE IF EXISTS doctors_supspecialization;
DROP TABLE IF EXISTS through_doctor_subspec;
DROP TABLE IF EXISTS through_doctors_specialization;
DROP TABLE IF EXISTS hospitals;


CREATE TABLE users (
id INTEGER NOT NULL PRIMARY KEY,
email CHAR NOT NULL,
password VARCHAR(45) NOT NULL,
created TIMESTAMP NOT NULL,
is_active BOOLEAN NOT NULL,
is_superuser BOOLEAN NOT NULL,
is_staff BOOLEAN NOT NULL,
 
     accept_private_policy BOOLEAN NOT NULL);

CREATE TABLE pacients (
id INTEGER NOT NULL PRIMARY KEY,
user INTEGER NOT NULL,
phone VARCHAR(45) NOT NULL UNIQUE);

CREATE TABLE doctors (
id INTEGER NOT NULL PRIMARY KEY,
phone VARCHAR(45) NOT NULL UNIQUE,
user INTEGER NOT NULL);

CREATE TABLE medicine_card (
id INTEGER NOT NULL PRIMARY KEY,
user INTEGER NOT NULL UNIQUE);

CREATE TABLE appointment_order (
id INTEGER NOT NULL PRIMARY KEY,
pacient INTEGER NOT NULL,
doctor INTEGER NOT NULL,
datetime TIMESTAMP NOT NULL,
confirmation BOOLEAN NOT NULL,
created TIMESTAMP NOT NULL,
appointment_took_place BOOLEAN NOT NULL,
doctor_subspecialization INTEGER,
doctor_specialization INTEGER NOT NULL,
hospital INTEGER NOT NULL);

CREATE TABLE doctors_appointment (
id INTEGER NOT NULL PRIMARY KEY,
pacient INTEGER NOT NULL,
doctor INTEGER NOT NULL,
appointment_order INTEGER,
anamnesis TEXT NOT NULL,
datetime TIMESTAMPTZ NOT NULL,
medicine_card INTEGER NOT NULL,
doctor_specialization INTEGER NOT NULL,
doctor_subspecialization INTEGER);

CREATE TABLE doctors_prescriptions (
id INTEGER NOT NULL PRIMARY KEY,
medicine_card INTEGER NOT NULL,
doctors_appointnent INTEGER NOT NULL);

CREATE TABLE doctors_specialization (
id INTEGER NOT NULL PRIMARY KEY,
title VARCHAR(45) NOT NULL UNIQUE);

CREATE TABLE doctors_supspecialization (
id INTEGER NOT NULL PRIMARY KEY,
doctor_specialization INTEGER NOT NULL,
title VARCHAR(45) NOT NULL UNIQUE);

CREATE TABLE through_doctor_subspec (
id INTEGER NOT NULL PRIMARY KEY,
doctor INTEGER NOT NULL,
doctor_subspecialization INTEGER NOT NULL);

CREATE TABLE through_doctors_specialization (
id INTEGER NOT NULL PRIMARY KEY,
doctor INTEGER NOT NULL,
specialization INTEGER NOT NULL);

CREATE TABLE hospitals (
id INTEGER NOT NULL PRIMARY KEY,
title VARCHAR(45) NOT NULL,
town VARCHAR(45) NOT NULL,
address VARCHAR(45) NOT NULL);

ALTER TABLE pacients ADD CONSTRAINT pacients_user_users_id FOREIGN KEY (user) REFERENCES users(id);
ALTER TABLE doctors ADD CONSTRAINT doctors_user_users_id FOREIGN KEY (user) REFERENCES users(id);
ALTER TABLE medicine_card ADD CONSTRAINT medicine_card_user_pacients_id FOREIGN KEY (user) REFERENCES pacients(id);
ALTER TABLE appointment_order ADD CONSTRAINT appointment_order_pacient_pacients_id FOREIGN KEY (pacient) REFERENCES pacients(id);
ALTER TABLE appointment_order ADD CONSTRAINT appointment_order_doctor_doctors_id FOREIGN KEY (doctor) REFERENCES doctors(id);
ALTER TABLE appointment_order ADD CONSTRAINT appointment_order_doctor_subspecialization_doctors_supspecialization_id FOREIGN KEY (doctor_subspecialization) REFERENCES doctors_supspecialization(id);
ALTER TABLE appointment_order ADD CONSTRAINT appointment_order_doctor_specialization_doctors_specialization_id FOREIGN KEY (doctor_specialization) REFERENCES doctors_specialization(id);
ALTER TABLE appointment_order ADD CONSTRAINT appointment_order_hospital_hospitals_id FOREIGN KEY (hospital) REFERENCES hospitals(id);
ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_pacient_pacients_id FOREIGN KEY (pacient) REFERENCES pacients(id);
ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_doctor_doctors_id FOREIGN KEY (doctor) REFERENCES doctors(id);

ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_appointment_order_appointment_order_id FOREIGN KEY (appointment_order) REFERENCES appointment_order(id);
ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_medicine_card_medicine_card_id FOREIGN KEY (medicine_card) REFERENCES medicine_card(id);
ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_doctor_specialization_doctors_specialization_id FOREIGN KEY (doctor_specialization) REFERENCES doctors_specialization(id);
ALTER TABLE doctors_appointment ADD CONSTRAINT doctors_appointment_doctor_subspecialization_doctors_supspecialization_id FOREIGN KEY (doctor_subspecialization) REFERENCES doctors_supspecialization(id);
ALTER TABLE doctors_prescriptions ADD CONSTRAINT doctors_prescriptions_medicine_card_medicine_card_id FOREIGN KEY (medicine_card) REFERENCES medicine_card(id);
ALTER TABLE doctors_prescriptions ADD CONSTRAINT doctors_prescriptions_doctors_appointnent_doctors_appointment_id FOREIGN KEY (doctors_appointnent) REFERENCES doctors_appointment(id);
ALTER TABLE doctors_supspecialization ADD CONSTRAINT doctors_supspecialization_doctor_specialization_doctors_specialization_id FOREIGN KEY (doctor_specialization) REFERENCES doctors_specialization(id);
ALTER TABLE through_doctor_subspec ADD CONSTRAINT through_doctor_subspec_doctor_doctors_id FOREIGN KEY (doctor) REFERENCES doctors(id);
ALTER TABLE through_doctor_subspec ADD CONSTRAINT through_doctor_subspec_doctor_subspecialization_doctors_supspecialization_id FOREIGN KEY (doctor_subspecialization) REFERENCES doctors_supspecialization(id);
ALTER TABLE through_doctors_specialization ADD CONSTRAINT through_doctors_specialization_doctor_doctors_id FOREIGN KEY (doctor) REFERENCES doctors(id);
ALTER TABLE through_doctors_specialization ADD CONSTRAINT through_doctors_specialization_specialization_doctors_specialization_id FOREIGN KEY (specialization) REFERENCES doctors_specialization(id);